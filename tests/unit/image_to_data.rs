extern crate spectral;
use spectral::prelude::*;

use crate::image_to_data::transform;

#[test]
#[cfg(target_family = "windows")]
fn can_url_encode_simple_image(){
	assert_that!(transform(&"<html>
		<body>
			<img src=\"https://picsum.photos/seed/10/10/10\"/>
		</body>
	</html>".to_string()))
		.is_ok_containing("<html>
		<body>
			<img src=\"data:application/octet-stream;base64,/9j/4QDeRXhpZgAASUkqAAgAAAAGABIBAwABAAAAAQAAABoBBQABAAAAVgAAABsBBQABAAAAXgAAACgBAwABAAAAAgAAABMCAwABAAAAAQAAAGmHBAABAAAAZgAAAAAAAABIAAAAAQAAAEgAAAABAAAABwAAkAcABAAAADAyMTABkQcABAAAAAECAwCGkgcAFgAAAMAAAAAAoAcABAAAADAxMDABoAMAAQAAAP//AAACoAQAAQAAAAoAAAADoAQAAQAAAAoAAAAAAAAAQVNDSUkAAABQaWNzdW0gSUQ6IDcxOP/bAEMACAYGBwYFCAcHBwkJCAoMFA0MCwsMGRITDxQdGh8eHRocHCAkLicgIiwjHBwoNyksMDE0NDQfJzk9ODI8LjM0Mv/bAEMBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMv/CABEIAAoACgMBIgACEQEDEQH/xAAVAAEBAAAAAAAAAAAAAAAAAAAEBf/EABQBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAZYKhx//xAAZEAACAwEAAAAAAAAAAAAAAAAAARAREyH/2gAIAQEAAQUCxSOxR//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/AY//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPwGv/8QAGRAAAgMBAAAAAAAAAAAAAAAAAAEQETFB/9oACAEBAAY/AnfDGOP/xAAaEAEAAgMBAAAAAAAAAAAAAAABABEhMUFR/9oACAEBAAE/IQjSgvDKgQ4NynhP/9oADAMBAAIAAwAAABAj/8QAFBEBAAAAAAAAAAAAAAAAAAAAAP/aAAgBAwEBPxB//8QAFBEBAAAAAAAAAAAAAAAAAAAAAP/aAAgBAgEBPxA//8QAHRABAQACAQUAAAAAAAAAAAAAAREAIUFxgZGx0f/aAAgBAQABPxBYqUkNjO2kybPdg40IHXG/r5xFhLpn/9k\" />
		</body>
	</html>".to_string());
}

#[test]
#[cfg(target_family = "unix")]
fn can_url_encode_simple_image(){
	assert_that!(transform(&"<html>
		<body>
			<img src=\"https://picsum.photos/seed/10/10/10\"/>
		</body>
	</html>".to_string()))
		.is_ok_containing("<html>
		<body>
			<img src=\"data:image/jpeg;base64,/9j/4QDeRXhpZgAASUkqAAgAAAAGABIBAwABAAAAAQAAABoBBQABAAAAVgAAABsBBQABAAAAXgAAACgBAwABAAAAAgAAABMCAwABAAAAAQAAAGmHBAABAAAAZgAAAAAAAABIAAAAAQAAAEgAAAABAAAABwAAkAcABAAAADAyMTABkQcABAAAAAECAwCGkgcAFgAAAMAAAAAAoAcABAAAADAxMDABoAMAAQAAAP//AAACoAQAAQAAAAoAAAADoAQAAQAAAAoAAAAAAAAAQVNDSUkAAABQaWNzdW0gSUQ6IDcxOP/bAEMACAYGBwYFCAcHBwkJCAoMFA0MCwsMGRITDxQdGh8eHRocHCAkLicgIiwjHBwoNyksMDE0NDQfJzk9ODI8LjM0Mv/bAEMBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMv/CABEIAAoACgMBIgACEQEDEQH/xAAVAAEBAAAAAAAAAAAAAAAAAAAEBf/EABQBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAZYKhx//xAAZEAACAwEAAAAAAAAAAAAAAAAAARAREyH/2gAIAQEAAQUCxSOxR//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/AY//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPwGv/8QAGRAAAgMBAAAAAAAAAAAAAAAAAAEQETFB/9oACAEBAAY/AnfDGOP/xAAaEAEAAgMBAAAAAAAAAAAAAAABABEhMUFR/9oACAEBAAE/IQjSgvDKgQ4NynhP/9oADAMBAAIAAwAAABAj/8QAFBEBAAAAAAAAAAAAAAAAAAAAAP/aAAgBAwEBPxB//8QAFBEBAAAAAAAAAAAAAAAAAAAAAP/aAAgBAgEBPxA//8QAHRABAQACAQUAAAAAAAAAAAAAAREAIUFxgZGx0f/aAAgBAQABPxBYqUkNjO2kybPdg40IHXG/r5xFhLpn/9k\" />
		</body>
	</html>".to_string());
}
